<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="common">

	<!-- 插入系统交易日志 -->
	<insert id="insertHsyhTransLog" parameterType="hashmap">
		insert into hsyh_trans_log
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="serialno != null and serialno != ''">
				serialno,
			</if>
			<if test="nsrmc != null and nsrmc != ''">
				nsrmc,
			</if>
			<if test="nsrsbh != null and nsrsbh != ''">
				nsrsbh,
			</if>
			<if test="inputtime != null and inputtime != ''">
				inputtime,
			</if>
			<if test="status != null and status != ''">
				status,
			</if>
			<if test="admtrsltsts != null and admtrsltsts != ''">
				admtrsltsts,
			</if>
			<if test="score != null and score != ''">
				score,
			</if>
			<if test="date != null and date != ''">
				date,
			</if>
			<if test="rulecd != null and rulecd != ''">
				rulecd
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="serialno != null and serialno != ''">
				#{serialno},
			</if>
			<if test="nsrmc != null and nsrmc != ''">
				#{nsrmc},
			</if>
			<if test="nsrsbh != null and nsrsbh != ''">
				#{nsrsbh},
			</if>
			<if test="inputtime != null and inputtime != ''">
				#{inputtime},
			</if>
			<if test="status != null and status != ''">
				#{status},
			</if>
			<if test="admtrsltsts != null and admtrsltsts != ''">
				#{admtrsltsts},
			</if>
			<if test="score != null and score != ''">
				#{score},
			</if>
			<if test="date != null and date != ''">
				#{date},
			</if>
			<if test="rulecd != null and rulecd != ''">
				#{rulecd}
			</if>
		</trim>
	</insert>

	<select id="queryTodoListInfo" parameterType="hashmap" resultType="map">
		select a.serialno   as "serialno",
			   a.nsrmc      as "nsrmc",
			   a.nsrsbh     as "nsrsbh",
			   a.flag       as "flag",
			   a.inputtime  as "inputtime",
			   a.ifkjedai   as "ifkjedai",
			   a.hytype     as "hytype",
			   a.hytypecode as "hytypecode",
			   a.xedoldcust as "xedoldcust"
		from hsyh_qymd a
			left join hsyh_trans_log b
		on a.serialno = b.serialno
		where flag = 'Y'  and b.serialno is null
		order by a.inputtime desc
	</select>

	<select id="saveExceptionInfo" parameterType="hashmap">
		insert into hsyh_exception_info
		values (#{serialno},#{entname},#{msg},#{inputtime})
	</select>

	<insert id="insertData" parameterType="map">
		insert into hsyh_qymd
		(serialno,nsrmc,nsrsbh,ifkjedai,hytype,hytypecode,xedoldcust,inputtime)
		values
		(	#{serialno},
			#{nsrmc},
			#{nsrsbh},
			#{ifkjedai},
			#{hytype},
			#{hytypecode},
			#{xedoldcust},
			#{inputtime})
	</insert>

	<insert id="insertData1" parameterType="List">
		insert into hsyh_qymd
		(serialno,nsrmc,nsrsbh,ifkjedai,hytype,hytypecode,xedoldcust,inputtime)
		select a.* from
		(
		<foreach collection="list" index="index" item="item" separator="union all">
			select
			#{item.serialno} as "serialno",
			#{item.nsrmc} as "nsrmc",
			#{item.nsrsbh} as "nsrsbh",
			#{item.ifkjedai} as "ifkjedai",
			#{item.hytype} as "hytype",
			#{item.hytypecode} as "hytypecode",
			#{item.xedoldcust} as "xedoldcust",
			#{item.inputtime} as "inputtime"
			from dual
		</foreach>
		) a
	</insert>

	<select id="queryResultInfo" parameterType="hashmap" resultType="map">
		select a.serialno   as "serialno",
			   a.nsrmc      as "nsrmc",
			   a.nsrsbh     as "nsrsbh",
			   a.inputtime  as "inputtime",
			   a.rulecd   	as "rulecd",
			   a.score     as "score"
		from hsyh_trans_log a
		where date = #{date}
		order by a.inputtime desc
	</select>
	<select id="queryResultCount" parameterType="hashmap" resultType="int">
		select count(1)
		from hsyh_trans_log a
		where date = #{date}
		order by a.inputtime desc
	</select>

</mapper>